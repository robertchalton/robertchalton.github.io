---
layout: post
title: Carbonated SQLCL - aka SODA support
date: '2015-12-15T13:14:00.000-08:00'
author: Kris Rice
tags:
- sqlcl
modified_time: '2016-06-10T13:03:58.862-07:00'
blogger_id: tag:blogger.com,1999:blog-37621059.post-9191648008386071995
blogger_orig_url: http://krisrice.blogspot.com/2015/12/carbonated-sqlcl-aka-soda-support.html
---

&nbsp; &nbsp; &nbsp;Oracle Database 12.1.0.2 introduced JSON support. &nbsp;This is supported in REST Data Services already and now in the latest SQLCL. &nbsp;This means ORDS can serve up the access to client applications and developers can have a command line way to interact and test features/queries/... in a nut shell a shell for JSON document storage. To use this feature the database will be to have patch #20885778 applied.<br />        <br /><pre class="brush:shell;">KLRICE@orcl &gt;soda<br /><br />SODA<br />------<br /><br />SODA allows schemaless application development using the JSON data model.<br />  SODA create <collection_name> <br />       Create a new collection <br /><br />  SODA list <br />       List all the collections <br /><br />  SODA get &lt;collection_name&gt; [-all | -f | -k | -klist] [{&lt;key&gt; | &lt;k1&gt; &lt;k2&gt; ... &gt; | &lt;qbe&gt;}]<br />       List documents the collection <br />       Optional arguments: <br />      -all    list the keys of all docs in the collection <br />      -k      list docs matching the specific <key> <br />      -klist  list docs matching the list of keys <br />      -f      list docs matching the <qbe> <br /><br />  SODA insert &lt;collection_name&gt; &lt;json_str filename=""&gt; <br />       Insert a new document within a collection <br /><br />  SODA drop &lt;collection_name&gt; <br />       Delete existing collection <br /><br />  SODA count &lt;collection_name&gt; [&lt;qbe&gt;] <br />       Count # of docs inside collection. <br />       Optional &lt;qbe&gt; returns # of matching docs<br /><br />  SODA replace &lt;collection_name&gt; &lt;oldkey&gt; &lt;new_ doc="" str=""&gt; <br />       Replace one doc for another <br /><br />  SODA remove &lt;collection_name&gt; [-k | -klist |-f] {&lt;key&gt; | &lt;k1&gt; &lt;k2&gt; ... | &lt;qbe&gt;} <br />       Remove doc(s) from collection <br />       Optional arguments: <br />      -k     remove doc in collection matching the specific &lt;key&gt; <br />      -klist remove doc in collection matching the list &lt;key1&gt; &lt;key2&gt; ... &gt; <br />      -f     remove doc in collection matching &lt;qbe&gt; <br /><br />KLRICE@orcl &gt;<br /></qbe></key></collection_name></pre><br />There's a lot in there for command so give them a try. &nbsp;SODA is underpinned but tables with JSON data in them. &nbsp;It's very easy to get going testing out the SODA features. &nbsp;Here's a simple collection create, insert, and query.<br /><br /><br /><pre class="brush:sql;">KLRICE@orcl &gt;soda create ODTUG<br />Successfully created collection: ODTUG<br /><br />KLRICE@orcl &gt;soda insert ODTUG {"content":"awesome"}<br />Json String inserted successfully.<br /><br />KLRICE@orcl &gt;soda insert ODTUG {"location":"chicago"}<br />Json String inserted successfully.<br /><br />KLRICE@orcl &gt;soda insert ODTUG {"best_of_week":"DB Symposium"}<br />Json String inserted successfully.<br /><br />KLRICE@orcl &gt;soda get ODTUG -f {"content":{"$startsWith":"a"}}<br /><br />Key:      7A01B31EBD7C484C88F431B8871DD165<br />Content:  {"content":"awesome"}<br />-----------------------------------------<br /> 1 row selected. <br /><br /></pre><br /><br /><h3>JavaScript and SODA</h3>Here's a quick example of using the SODA libraries from javascript. &nbsp;Also in here is a new feature of scripting. &nbsp;The javascript can be inlined into a sql script. &nbsp;Notice that it's soda.<b>sql</b>&nbsp;&lt;&lt;&lt; .sql that has javascript in it, let that sink in for a minute with the possibilities.<br /><br /><pre class="brush:javascript;">KLRICE@orcl &gt;<b>@soda.sql</b><br /><br />Caffeinated SODA <br />Dropping the old<br />Created the old<br />Inserted Document<br />Searching...<br />CBFE3D919E814094954BB217A2F6916E<br />{ "name" : "Alex", "friends" : "50" }<br /><br /><br />KLRICE@orcl &gt;!cat soda.sql<br /><br />script<br />ctx.write('Caffeinated SODA \n');<br /><br /><br />var OracleRDBMSClient = Java.type("oracle.soda.rdbms.OracleRDBMSClient");<br />var OracleDataSource = Java.type('oracle.jdbc.pool.OracleDataSource');<br />var cl = new OracleRDBMSClient();<br />var db = cl.getDatabase(conn);<br /><br />ctx.write("Dropping the old\n")<br />var foo = db.admin().createCollection("foo");<br /> foo.admin().drop();<br />ctx.write("Created the old\n")<br />    foo = db.admin().createCollection("foo"); <br /><br /><br />var doc = db.createDocumentFromString("{ \"name\" : \"Alex\", \"friends\" : \"50\" }");<br />ctx.write("Inserted Document\n")<br /> foo.insertAndGet(doc);<br /><br />conn.commit();<br /><br />var f = db.createDocumentFromString(JSON.stringify( {"name" : { "$startsWith" : "A" }}));<br />ctx.write("Searching...\n")<br />var c = foo.find().filter(f).getCursor();<br /><br /><br />while (c.hasNext()) {<br /> cDoc = c.next();<br /> ctx.write(cDoc.getKey() + "\n");<br /> ctx.write(cDoc.getContentAsString());<br /> ctx.write("\n\n"); <br />}<br /><br />ctx.write("\n\n");<br />/<br /><br />KLRICE@orcl&gt;<br /></pre><br /><br /><h3>Gory Details of the release</h3>Someone asked about change logs for these SQLCL updates. &nbsp;Here's a filtered version of the gory details<br /><br /><button onclick="if(document.getElementById('spoiler') .style.display=='none') {document.getElementById('spoiler') .style.display=''}else{document.getElementById('spoiler') .style.display='none'}" title="Change Log" type="button">Show/hide Change Log</button><br /><br /><div id="spoiler" style="display: none;"><br /><pre>------------------------------------------------------------------------<br />Changed CD to look at absolute paths and changed FileUtils to respect them on windows too.<br />------------------------------------------------------------------------<br />fixed auto append of .js when there's a ../ in the path<br />------------------------------------------------------------------------<br />New sql.exe to pick up last carsten  fix<br />Also changed auto js fix to File.separator as it doesnt work on Windows \.  Now seems good<br />------------------------------------------------------------------------<br />Added history for script as well.<br />------------------------------------------------------------------------<br />Bug 21304531 - precision of interval day to second<br />------------------------------------------------------------------------<br />20950786: converting normal table/owner names to upper case, so that quoteIdentifier won't quote lower case names <br />------------------------------------------------------------------------<br />Bug 21543451 - set numformat 9 is not supported<br />------------------------------------------------------------------------<br />Bug 21976274 - edit buffer file being written to different directories based on cd commands<br />------------------------------------------------------------------------<br />Bug 21971064 - run ddl command when disconnected get parse error<br />------------------------------------------------------------------------<br />Bug 21971059 - syntax issue in help topic for 'ddl' command<br />------------------------------------------------------------------------<br />Bug 22076298 - info "public".dbms_output get npe<br />------------------------------------------------------------------------<br />Bug 22095255 - repeat command does not work fine when iterations is large<br />------------------------------------------------------------------------<br />Bug 22075376 - desc fail while more than one space exist between desc and object name<br />------------------------------------------------------------------------<br />Bug 21892799 - parameters need to be added in syntax for alias drop<br />------------------------------------------------------------------------<br />Bug 21381415 - set numformat is not working with binary_float and binary_double type<br />------------------------------------------------------------------------<br />Bug 22095190 - repeat command should check for the valid values of iterations and seconds<br />------------------------------------------------------------------------<br />Bug 21662069 - justify option of column command is not displayed<br />Some cleanups in the code for number formats.<br />------------------------------------------------------------------------<br />Bug 21482640 - the noprint column is counted for linesize<br />------------------------------------------------------------------------<br />Bug 21430771 - a label of compute is always single quoted in sql*plus<br />------------------------------------------------------------------------<br />Bug 21477780 - null clause of column command should override the value set by set null<br />------------------------------------------------------------------------<br />Bug 21477780 - null clause of column command should override the value set by set null<br />Have a better fix now.<br />------------------------------------------------------------------------<br />opened up repeat more than just sql<br />------------------------------------------------------------------------<br />Bug 21111361 - some invalid options for set autocommit are now seems to be valid<br />------------------------------------------------------------------------<br />Bug 22142042 - col format does not work fine<br />------------------------------------------------------------------------<br />Adding guards around keymap identification as it seems to be null for Christoph Ruepprich.  Its working fine here, but from the stack trace, the NPE points to a null keymap<br />------------------------------------------------------------------------<br />Added orajsoda<br />Fixed csv not using the nls settings<br />misc things with repeat<br />------------------------------------------------------------------------<br />forcing full redraw for insight on sqlcl where there is only one completion item.<br />------------------------------------------------------------------------<br />Added set clear to allow clear screen to  go to the bottom.  Insight now refreshes correctly on single and multi option.<br />------------------------------------------------------------------------<br />Removing ALIAS error code setting from succesful codes <br />------------------------------------------------------------------------<br />Bug 20871360 - DESC OR INFO DOESN'T SHOW SCHEMA NAME IF CREATE TABLE USING TYPES OF OTHERS <br />------------------------------------------------------------------------<br />Bug 22095255 - repeat command does not work fine when iterations is large<br />added Integer.MAXVAL to messageformat tocomplete the  message<br />------------------------------------------------------------------------<br />fixed spaces in the file name for save<br />fixed that when save specified it does not also print to stdout<br />------------------------------------------------------------------------<br />Bug 22107961 - INFO TABLE: NO SIZE FOR RAW TYPE<br />------------------------------------------------------------------------<br />Bug 22083173 - INFO TABLE: UNNEED LENGTH SEMANTICS INFO FOR NCHAR TYPE <br />------------------------------------------------------------------------<br />Re Kris: colored completion<br />------------------------------------------------------------------------<br />Re Kris: set color on -- toggles completion color<br />------------------------------------------------------------------------<br />All documentation SQL formatting tuned.<br />------------------------------------------------------------------------<br />Bug 21102872 - SET AUTOCOMMIT 0 DOES NOT WORK AS EXPECT<br />------------------------------------------------------------------------<br />Bug 20872793 - DESC IS NOT DESCRIBING A TYPE CORRECTLY WHEN CREATED USING INTERVAL <br />------------------------------------------------------------------------<br />Bug 21102741 - SET AUTOCOMMIT SHOWS THE SAME ERROR FOR DIFFERENT TYPE OF INVALID OPTIONS <br />------------------------------------------------------------------------<br />Bug 21104192 - SET AUTOCOMMIT ON COMMITS ON EVERYTHING <br />------------------------------------------------------------------------<br />Bug 21112625 - SET APPINFO WITH A LONG TEXT DOES NOT GET ERROR <br />------------------------------------------------------------------------<br />Bug 21381052 - long is not used when print nclob data<br />Fix is only for select query.<br />------------------------------------------------------------------------<br />change save ddl to respect quoted filenames<br />------------------------------------------------------------------------<br />Changed new commands to be bold + underline.  People using white terminals couldn't see the white text and there's no way I could find to determine the color of the terminal<br />------------------------------------------------------------------------<br />Changed to look for ojdbc8 not 6 as 6 is very old at this point<br />------------------------------------------------------------------------<br />Cleaned up the set feedback section<br />------------------------------------------------------------------------<br />Adding dependency for SODA<br />------------------------------------------------------------------------<br />Bug 21477290 - "" and '' should be invalid when used as column_name in column command<br />------------------------------------------------------------------------<br />First update to enable REST services integration<br />------------------------------------------------------------------------<br />Adding nohistory blacklist for sqlcl.  What do you not want persisted?  Add it here.<br />nohistory set,connect,show,load,whatever<br />show nohistory<br />BARRY@orclüçªüç∫ &gt;nohis show,set,connect,nohistory,history<br />BARRY@orclüçªüç∫ &gt;his clear<br />History Cleared<br />BARRY@orclüçªüç∫ &gt;show nohistory<br />NOHISTORY: show,set,connect,nohistory,history<br />BARRY@orclüçªüç∫ &gt;set echo on<br />BARRY@orclüçªüç∫ &gt;select 1 from dual;<br />1  <br />1  <br />BARRY@orclüçªüç∫ &gt;his<br />  1  select 1 from dual<br />BARRY@orclüçªüç∫ &gt;<br />------------------------------------------------------------------------<br />BUG 21843939 - SET PAUSE WITH INVALID GET NO ERROR <br />------------------------------------------------------------------------<br /> Added option to specifiy delimiters with the set sqlformat command.  set sqlformat delimited | ' '<br />------------------------------------------------------------------------<br />Rolling back parser changes so all work is done in set nohistory. <br />BARRY@orclüçªüç∫ &gt;his clear<br />History Cleared<br />BARRY@orclüçªüç∫ &gt;set nohistory set,show connect<br />BARRY@orclüçªüç∫ &gt;show nohistory<br />NOHISTORY: set,show,connect<br />BARRY@orclüçªüç∫ &gt;set echo on<br />BARRY@orclüçªüç∫ &gt;show echo<br />echo ON<br />BARRY@orclüçªüç∫ &gt;his<br />BARRY@orclüçªüç∫ &gt;<br />------------------------------------------------------------------------<br />Bug 22241225 - SQLCLI : COPY FROM.. COMMAND FAILS TO CONNECT<br />------------------------------------------------------------------------<br />Bug 21762251 - TABLE WITH LONG DATATYPE COLUMN CAN NOT BE COPIED <br />------------------------------------------------------------------------<br />Bug 22244310 - history help is invalid<br />------------------------------------------------------------------------<br />Bug 21625285 - ERROR FROM SQLCL DOES NOT TELL THE REAL REASON WHEN COLUMN NUMBER DOES NOT MATCH <br />------------------------------------------------------------------------<br />Added soda create, soda list, soda get, soda drop, soda insert<br />------------------------------------------------------------------------<br />Set property fixed. so set property http_proxy http://www-proxy.us.oracle.com:80 etc now works again.<br />set ddl options fixed so all options now work.<br />added ade changes for build in rdbms_trunk (in or out of view)<br />------------------------------------------------------------------------<br />make sure ctrl c stops the printing of a result set when the sqlformat is not default. Ex when set sqlformat ansiconsole. Make sure ctrl c works the same as when sqlformat is default<br />------------------------------------------------------------------------<br />CTRL-c is now working in ansiconsole, but there is a null passing through the exception handler, which we need to prevent.<br />------------------------------------------------------------------------<br />Fixed url's over proxies specifically over http_proxy and https_proxy<br />------------------------------------------------------------------------<br />Fixed ctrl-c in editor, so it exits back to the prompt.<br />------------------------------------------------------------------------<br />Case enum has to be visible to DBConfig<br />------------------------------------------------------------------------<br />Added ability to filter failed commands from the history. history fails now flips between showing and hiding the failures in running.<br />Also amended aliases to show descriptions so we can see what an alias does.<br />------------------------------------------------------------------------<br />Plugged in new formatter<br />------------------------------------------------------------------------<br />Adding record counts and pretty print. <br />------------------------------------------------------------------------<br />Bug 21460696 - SET NUMWIDTH TO AN INVALID VALUE GET NUMBERFORMATEXCEPTION <br />------------------------------------------------------------------------<br />Bug 22244801 - some history abbreviations are not supported<br />------------------------------------------------------------------------<br />Bug 22132269 - repeat command get arrayindexoutofboundsexception when no history and no buffer<br />------------------------------------------------------------------------<br />Bug 22244310 - history help is invalid<br />------------------------------------------------------------------------<br />Added support for soda remove and more exception handling. <br />------------------------------------------------------------------------<br />Setting pagesize to 0 will just display data with Paging turned off.<br />------------------------------------------------------------------------<br />Bug 22172130 - missing '&gt;' in help of format<br />------------------------------------------------------------------------<br />Bug 22252847 - help:net: &lt;sql statement=""&gt; should something else<br />------------------------------------------------------------------------<br />Added support for additional options in soda get. <br />------------------------------------------------------------------------<br />Merged soda get and soda find. Added additional optional arguments for soda get. <br />------------------------------------------------------------------------<br />Bug 21822565 - DESC A PACKAGE GETS 0 AS THE SIZE OF SOME DATATYPE<br />------------------------------------------------------------------------<br />Bug 21111291 - SET AUTOCOMMIT CAN ACCEPT A NEGATIVE NUMBER <br />------------------------------------------------------------------------<br />Bug 21971072 - DDL COMMAND: ONLY UPPER CASE IS RECOGNIZED IN <type> OPTION<br />------------------------------------------------------------------------<br />Bug 21636020 - DDL DOES NOT RECOGNIZE TABLE PARTITION AS OBJECT TYPE IF MULTIPLE OBJS W/NAME <br />------------------------------------------------------------------------<br />Bug 22005555 - DDL COMMAND:SHOW DDL OF TYPE BODY GET NPE <br />------------------------------------------------------------------------<br />Bug 22095455 - FAIL TO DESC SYNONYM FOR LOWER CASE TABLE <br />------------------------------------------------------------------------<br />Bug 22005616 - DDL COMMAND:SHOW DDL OF TYPE ALSO SHOW TYPE BODY <br />------------------------------------------------------------------------<br />Bug 22007103 - DESC A TABLE WITH A SPACE IN ITS NAME IS NOT WORKING FINE <br />------------------------------------------------------------------------<br />Bug 22133949 - ed is not editing the sql in buffer<br />------------------------------------------------------------------------<br />Bug 22132239 - repeat command should require a connection<br />------------------------------------------------------------------------<br />Bug 22311951 - repeat: it execute using 1s for sleep when sleep is not a number<br />------------------------------------------------------------------------<br />Feedback was broken in scripts<br />Fixed xquery issues in set<br />Bug 21375193 - set xquery node default is throwing exception<br />------------------------------------------------------------------------<br />xquery set issues whe brought out to all commands. Tightened checks.<br />------------------------------------------------------------------------<br />Title(Top &amp; Bottom) commands should work with COLUMN commands NEW_VALUE and OLD_VALUE.<br />This is fixed now.<br />------------------------------------------------------------------------<br />Bug 22095122 - DESC NOT WORK FOR SAME SYNONYMS IN DIFFERENT SCHEMAS <br />------------------------------------------------------------------------<br />Added restrict to host.  Need to check others too.<br />------------------------------------------------------------------------<br />Added a check to make sure unnecessary header lines are not added.<br />------------------------------------------------------------------------<br />Filed thru restrict and fixed all permissions.<br />Command Level 1 Level 2 Level 3<br />EDIT disabled disabled disabled<br />GET     disabled<br />HOST disabled disabled disabled<br />SAVE   disabled disabled<br />SPOOL   disabled disabled<br />START     disabled<br />STORE   disabled disabled<br />------------------------------------------------------------------------<br />Bug 21609843 - COPY COMMAND SHOULD FAIL IMMEDIATELY WHEN USERNAME IS NOT SPECIFIED <br />------------------------------------------------------------------------<br /> <br /></type></pre></div>